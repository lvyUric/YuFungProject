# ä¿é™©å…¬å¸æ•°æ®åº“é›†åˆæ–‡æ¡£ (companies)

## ğŸ“‹ é›†åˆæ¦‚è¿°

`companies` é›†åˆå­˜å‚¨å¹³å°æ¥å…¥çš„ä¿é™©ç»çºªå…¬å¸åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬åŸºæœ¬ä¿¡æ¯ã€è”ç³»æ–¹å¼ã€åœ°å€ä¿¡æ¯ã€ä¸šåŠ¡ä¿¡æ¯ç­‰ã€‚é‡‡ç”¨ç®€åŒ–çš„å­—æ®µç»“æ„ï¼Œæ”¯æŒé«˜æ•ˆçš„å…¬å¸ç®¡ç†åŠŸèƒ½ã€‚

## ğŸ—ï¸ å­—æ®µç»“æ„å®šä¹‰

### åŸºæœ¬ä¿¡æ¯å­—æ®µ

| å­—æ®µå | æ•°æ®ç±»å‹ | æ˜¯å¦å¿…å¡« | ç´¢å¼•ç±»å‹ | ä¸­æ–‡è¯´æ˜ | å¤‡æ³¨ |
|--------|----------|----------|----------|----------|------|
| `_id` | ObjectId | æ˜¯ | ä¸»é”® | MongoDBä¸»é”®ID | ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ |
| `company_id` | String | æ˜¯ | å”¯ä¸€ç´¢å¼• | å…¬å¸å”¯ä¸€æ ‡è¯† | ä¸šåŠ¡ä¸»é”®ï¼Œæ ¼å¼ï¼šCMP+æ—¶é—´æˆ³+éšæœºæ•° |
| `company_name` | String | æ˜¯ | æ™®é€šç´¢å¼• | å…¬å¸åç§° | ä¿é™©ç»çºªå…¬å¸å®Œæ•´åç§° |
| `company_code` | String | å¦ | æ™®é€šç´¢å¼• | å…¬å¸ä»£ç  | å†…éƒ¨å…¬å¸ä»£ç ï¼Œç”¨äºä¸šåŠ¡æ ‡è¯† |

### è´Ÿè´£äººä¿¡æ¯å­—æ®µ

| å­—æ®µå | æ•°æ®ç±»å‹ | æ˜¯å¦å¿…å¡« | ç´¢å¼•ç±»å‹ | ä¸­æ–‡è¯´æ˜ | å¤‡æ³¨ |
|--------|----------|----------|----------|----------|------|
| `contact_person` | String | å¦ | æ™®é€šç´¢å¼• | è”ç»œäºº | æ—¥å¸¸è”ç»œäººå§“å |

### è”ç³»æ–¹å¼å­—æ®µ

| å­—æ®µå | æ•°æ®ç±»å‹ | æ˜¯å¦å¿…å¡« | ç´¢å¼•ç±»å‹ | ä¸­æ–‡è¯´æ˜ | å¤‡æ³¨ |
|--------|----------|----------|----------|----------|------|
| `tel_no` | String | å¦ | æ™®é€šç´¢å¼• | å›ºå®šç”µè¯ | å…¬å¸å›ºå®šç”µè¯å·ç  |
| `mobile` | String | å¦ | æ™®é€šç´¢å¼• | ç§»åŠ¨ç”µè¯ | å…¬å¸ç§»åŠ¨ç”µè¯å·ç  |
| `contact_phone` | String | å¦ | æ™®é€šç´¢å¼• | è”ç³»ç”µè¯ | ä¸»è¦è”ç³»ç”µè¯ï¼ˆå…¼å®¹æ—§ç‰ˆæœ¬ï¼‰ |
| `email` | String | æ˜¯ | æ™®é€šç´¢å¼• | é‚®ç®±åœ°å€ | å…¬å¸å®˜æ–¹é‚®ç®±åœ°å€ |

### åœ°å€å­—æ®µ

| å­—æ®µå | æ•°æ®ç±»å‹ | æ˜¯å¦å¿…å¡« | ç´¢å¼•ç±»å‹ | ä¸­æ–‡è¯´æ˜ | å¤‡æ³¨ |
|--------|----------|----------|----------|----------|------|
| `address_cn_detail` | String | å¦ | æ™®é€šç´¢å¼• | ä¸­æ–‡è¯¦ç»†åœ°å€ | å…¬å¸ä¸­æ–‡è¯¦ç»†åœ°å€ |
| `address_en_detail` | String | å¦ | æ™®é€šç´¢å¼• | è‹±æ–‡è¯¦ç»†åœ°å€ | å…¬å¸è‹±æ–‡è¯¦ç»†åœ°å€ |
| `address` | String | å¦ | æ™®é€šç´¢å¼• | åœ°å€ | åŸæœ‰åœ°å€å­—æ®µï¼ˆå…¼å®¹æ—§ç‰ˆæœ¬ï¼‰ |

### ä¸šåŠ¡ä¿¡æ¯å­—æ®µ

| å­—æ®µå | æ•°æ®ç±»å‹ | æ˜¯å¦å¿…å¡« | ç´¢å¼•ç±»å‹ | ä¸­æ–‡è¯´æ˜ | å¤‡æ³¨ |
|--------|----------|----------|----------|----------|------|
| `broker_code` | String | å¦ | æ™®é€šç´¢å¼• | ç»çºªäººä»£ç  | åˆä½œç»çºªäººè¯†åˆ«ä»£ç  |
| `link` | String | å¦ | æ—  | ç›¸å…³é“¾æ¥ | å…¬å¸å®˜ç½‘æˆ–ç›¸å…³é¡µé¢é“¾æ¥ |

### ç™»å½•ä¿¡æ¯å­—æ®µ

| å­—æ®µå | æ•°æ®ç±»å‹ | æ˜¯å¦å¿…å¡« | ç´¢å¼•ç±»å‹ | ä¸­æ–‡è¯´æ˜ | å¤‡æ³¨ |
|--------|----------|----------|----------|----------|------|
| `username` | String | å¦ | ç¨€ç–ç´¢å¼• | ç”¨æˆ·å | å…¬å¸ç™»å½•ç”¨æˆ·å |
| `password_hash` | String | å¦ | æ—  | å¯†ç å“ˆå¸Œå€¼ | åŠ å¯†åçš„å¯†ç ï¼Œä¸è¿”å›ç»™å®¢æˆ·ç«¯ |

### ç³»ç»Ÿç®¡ç†å­—æ®µ

| å­—æ®µå | æ•°æ®ç±»å‹ | æ˜¯å¦å¿…å¡« | ç´¢å¼•ç±»å‹ | ä¸­æ–‡è¯´æ˜ | å¤‡æ³¨ |
|--------|----------|----------|----------|----------|------|
| `valid_start_date` | Date | æ˜¯ | æ—  | æœ‰æ•ˆæœŸå¼€å§‹æ—¥æœŸ | å…¬å¸åˆä½œæœ‰æ•ˆæœŸå¼€å§‹æ—¶é—´ |
| `valid_end_date` | Date | æ˜¯ | æ™®é€šç´¢å¼• | æœ‰æ•ˆæœŸç»“æŸæ—¥æœŸ | å…¬å¸åˆä½œæœ‰æ•ˆæœŸç»“æŸæ—¶é—´ |
| `user_quota` | Number | æ˜¯ | æ—  | ç”¨æˆ·é…é¢ | å…è®¸åˆ›å»ºçš„ç”¨æˆ·æ•°é‡ä¸Šé™ |
| `current_user_count` | Number | æ˜¯ | æ—  | å½“å‰ç”¨æˆ·æ•°é‡ | å·²åˆ›å»ºçš„ç”¨æˆ·æ•°é‡ |
| `status` | String | æ˜¯ | æ™®é€šç´¢å¼• | çŠ¶æ€ | active=æœ‰æ•ˆ, inactive=åœç”¨, expired=è¿‡æœŸ |
| `remark` | String | å¦ | æ—  | å¤‡æ³¨ä¿¡æ¯ | å…¶ä»–å¤‡æ³¨è¯´æ˜ |
| `submitted_by` | String | å¦ | æ™®é€šç´¢å¼• | æäº¤äºº | åˆ›å»ºè¯¥å…¬å¸è®°å½•çš„æ“ä½œå‘˜ |
| `created_at` | Date | æ˜¯ | æ™®é€šç´¢å¼• | åˆ›å»ºæ—¶é—´ | è®°å½•åˆ›å»ºæ—¶é—´ |
| `updated_at` | Date | æ˜¯ | æ—  | æ›´æ–°æ—¶é—´ | è®°å½•æœ€åæ›´æ–°æ—¶é—´ |

## ğŸ“š ç´¢å¼•ç­–ç•¥

### å•å­—æ®µç´¢å¼•

```javascript
// ä¸»è¦ä¸šåŠ¡ç´¢å¼•
db.companies.createIndex({ "company_id": 1 }, { "unique": true });
db.companies.createIndex({ "company_name": 1 }, { "unique": true });
db.companies.createIndex({ "company_code": 1 });
db.companies.createIndex({ "contact_person": 1 });
db.companies.createIndex({ "tel_no": 1 });
db.companies.createIndex({ "mobile": 1 });
db.companies.createIndex({ "email": 1 });
db.companies.createIndex({ "broker_code": 1 });
db.companies.createIndex({ "username": 1 }, { "sparse": true });
db.companies.createIndex({ "submitted_by": 1 });
db.companies.createIndex({ "status": 1 });
db.companies.createIndex({ "valid_end_date": 1 });
db.companies.createIndex({ "created_at": 1 });
```

### å¤åˆç´¢å¼•

```javascript
// å¸¸ç”¨æŸ¥è¯¢ç»„åˆç´¢å¼•
db.companies.createIndex({ "status": 1, "valid_end_date": 1 });
db.companies.createIndex({ "company_name": 1, "company_code": 1 });
```

## ğŸ“„ æ–‡æ¡£ç¤ºä¾‹

### å®Œæ•´å…¬å¸è®°å½•ç¤ºä¾‹

```javascript
{
  "_id": ObjectId("65f7b8e4c12345678901234a"),
  "company_id": "CMP_202401150001",
  "company_name": "ä¸­åä¿é™©ç»çºªæœ‰é™å…¬å¸",
  "company_code": "ZHBX001",
  
  // è´Ÿè´£äººä¿¡æ¯
  "contact_person": "å¼ ç»ç†",
  
  // è”ç³»æ–¹å¼
  "tel_no": "010-88888888",
  "mobile": "13800138000",
  "contact_phone": "010-88888888",
  "email": "info@zhbx.com",
  
  // åœ°å€ä¿¡æ¯
  "address_cn_detail": "åŒ—äº¬å¸‚æœé˜³åŒºå»ºå›½é—¨å¤–å¤§è¡—1å·å›½è´¸å¤§å¦Aåº§15å±‚",
  "address_en_detail": "15F, Tower A, CWTC, No.1 Jianguomenwai Avenue, Chaoyang District, Beijing",
  "address": "åŒ—äº¬å¸‚æœé˜³åŒºå»ºå›½é—¨å¤–å¤§è¡—1å·å›½è´¸å¤§å¦Aåº§15å±‚",
  
  // ä¸šåŠ¡ä¿¡æ¯
  "broker_code": "BRK001",
  "link": "https://www.zhbx.com",
  
  // ç™»å½•ä¿¡æ¯
  "username": "zhbx_admin",
  "password_hash": "$2a$10$...",
  
  // ç³»ç»Ÿå­—æ®µ
  "valid_start_date": ISODate("2024-01-01T00:00:00.000Z"),
  "valid_end_date": ISODate("2025-12-31T23:59:59.999Z"),
  "user_quota": 100,
  "current_user_count": 15,
  "status": "active",
  "remark": "é‡è¦åˆä½œä¼™ä¼´",
  "submitted_by": "admin",
  "created_at": ISODate("2024-01-15T08:30:00.000Z"),
  "updated_at": ISODate("2024-01-15T10:45:00.000Z")
}
```

### æœ€å°åŒ–å…¬å¸è®°å½•ç¤ºä¾‹

```javascript
{
  "_id": ObjectId("65f7b8e4c12345678901234b"),
  "company_id": "CMP_202401150002",
  "company_name": "å®‰æ³°ä¿é™©ä»£ç†æœ‰é™å…¬å¸",
  "contact_phone": "021-88888888",
  "email": "info@antai.com",
  "valid_start_date": ISODate("2024-01-01T00:00:00.000Z"),
  "valid_end_date": ISODate("2024-12-31T23:59:59.999Z"),
  "user_quota": 50,
  "current_user_count": 0,
  "status": "active",
  "created_at": ISODate("2024-01-15T09:00:00.000Z"),
  "updated_at": ISODate("2024-01-15T09:00:00.000Z")
}
```

## ğŸ“ˆ æŸ¥è¯¢æ¨¡å¼è¯´æ˜

### å¸¸ç”¨æŸ¥è¯¢åœºæ™¯

1. **æŒ‰å…¬å¸åç§°æŸ¥è¯¢**
   ```javascript
   db.companies.find({ "company_name": /ä¸­å/ });
   ```

2. **æŒ‰è”ç³»äººæŸ¥è¯¢**
   ```javascript
   db.companies.find({ "contact_person": /å¼ / });
   ```

3. **æŒ‰çŠ¶æ€å’Œæœ‰æ•ˆæœŸæŸ¥è¯¢**
   ```javascript
   db.companies.find({
     "status": "active",
     "valid_end_date": { $gte: new Date() }
   });
   ```

4. **æŒ‰é‚®ç®±æŸ¥è¯¢**
   ```javascript
   db.companies.find({ "email": "info@zhbx.com" });
   ```

### èšåˆç»Ÿè®¡ç¤ºä¾‹

```javascript
// æŒ‰çŠ¶æ€ç»Ÿè®¡å…¬å¸æ•°é‡
db.companies.aggregate([
  {
    $group: {
      _id: "$status",
      count: { $sum: 1 },
      total_quota: { $sum: "$user_quota" },
      total_users: { $sum: "$current_user_count" }
    }
  },
  { $sort: { count: -1 } }
]);
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ•°æ®å®Œæ•´æ€§**: 
   - `company_id` å’Œ `company_name` å¿…é¡»å”¯ä¸€
   - `email` å­—æ®µå¿…é¡»å¡«å†™ä¸”æ ¼å¼æ­£ç¡®
   - æœ‰æ•ˆæœŸå­—æ®µå¿…é¡»åˆç†è®¾ç½®

2. **æ€§èƒ½ä¼˜åŒ–**:
   - ä½¿ç”¨å¤åˆç´¢å¼•æé«˜å¸¸ç”¨æŸ¥è¯¢æ€§èƒ½
   - ç¨€ç–ç´¢å¼•ç”¨äºå¯é€‰å­—æ®µå¦‚ `username`
   - å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®

3. **å®‰å…¨æ€§**:
   - `password_hash` å­—æ®µä¸åº”è¿”å›ç»™å®¢æˆ·ç«¯
   - æ•æ„Ÿä¿¡æ¯éœ€è¦åŠ å¯†å­˜å‚¨

4. **å…¼å®¹æ€§**:
   - ä¿ç•™ `address` å’Œ `contact_phone` å­—æ®µç”¨äºå‘åå…¼å®¹
   - æ–°åº”ç”¨ç¨‹åºåº”ä½¿ç”¨è¯¦ç»†åœ°å€å­—æ®µ 