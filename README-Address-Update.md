# 保险公司管理模块 - 地址级联选择功能更新

## 🎯 功能概述

为保险公司管理模块添加了省市县级联选择功能，支持中英文地址信息的录入和管理。

## ✨ 新增功能

### 1. 省市县级联选择
- **智能级联**：选择省份后自动加载对应城市，选择城市后自动加载区县
- **中英文支持**：同时保存中文和英文地址信息
- **回显功能**：编辑时正确显示已选择的地址信息
- **验证提示**：实时验证并提供友好的错误提示

### 2. 新增地址字段

#### 中文地址字段
- `address_cn_province` - 省/自治区/直辖市
- `address_cn_city` - 市
- `address_cn_district` - 县/区
- `address_cn_detail` - 详细地址

#### 英文地址字段
- `address_en_province` - 省/自治区/直辖市（英文）
- `address_en_city` - 市（英文）
- `address_en_district` - 县/区（英文）
- `address_en_detail` - 详细地址（英文）

#### 兼容字段
- `address` - 完整地址（保留兼容性）

## 🏗️ 技术实现

### 前端组件

#### AddressSelector 组件
- **路径**: `stelory-admin/src/components/AddressSelector.tsx`
- **功能**: 提供省市县级联选择界面
- **特性**:
  - 响应式设计，支持移动端
  - 智能级联加载
  - 错误状态显示
  - 禁用状态管理

#### 地区数据源
- **路径**: `stelory-admin/src/data/chinaRegions.ts`
- **内容**: 包含主要省市县的中英文数据
- **支持地区**: 北京、天津、上海、重庆、广东、江苏、浙江等

### 后端更新

#### 数据模型
- **文件**: `internal/model/user.go`
- **更新**: Company 结构体新增省市县地址字段
- **兼容性**: 保留原有 address 字段

#### 业务逻辑
- **文件**: `internal/service/company_service.go`
- **更新**: 
  - CreateCompany 方法支持新地址字段
  - UpdateCompany 方法支持新地址字段
  - convertToCompanyInfo 方法返回完整地址信息

## 🎨 界面更新

### 公司表单 (CompanyForm)
- **分组显示**: 地址信息单独分组
- **级联选择**: 省市县三级联动
- **双语输入**: 中文详细地址必填，英文详细地址可选
- **智能组合**: 自动生成完整地址用于兼容性

### 公司列表 (CompanyManagement)
- **地址显示**: 优先显示省市县组合地址
- **兼容回退**: 如果新地址为空则显示原地址字段
- **截断处理**: 长地址自动截断并显示完整提示

## 📋 使用说明

### 新增公司
1. 打开公司管理页面
2. 点击"新增公司"按钮
3. 在"地址信息"部分：
   - 依次选择省份、城市、区县
   - 填写中文详细地址（必填）
   - 可选填写英文详细地址
4. 完成其他必填信息并保存

### 编辑公司
1. 在公司列表中点击"编辑"按钮
2. 地址信息会自动回显到级联选择器
3. 可修改省市县选择或详细地址
4. 保存更新

## 🔧 开发说明

### 添加新地区数据
1. 编辑 `stelory-admin/src/data/chinaRegions.ts`
2. 按照现有格式添加新的省市县数据
3. 确保包含中英文名称和正确的编码

### 扩展地址字段
如需添加更多地址相关字段：
1. 更新 `internal/model/user.go` 中的 Company 结构体
2. 更新前端 `companyService.ts` 中的接口定义
3. 更新后端 service 中的创建和更新逻辑
4. 更新前端表单组件

## 🚀 部署注意事项

### 数据库迁移
新增字段为可选字段，无需特殊迁移脚本。现有数据仍可正常访问，新字段默认为空值。

### 兼容性
- 保留原有 `address` 字段，确保向后兼容
- API 接口保持兼容，新字段为可选
- 前端自动处理新旧地址字段的显示

## 📊 测试用例

### 功能测试
- [x] 省份选择触发城市加载
- [x] 城市选择触发区县加载
- [x] 直辖市自动选择城市
- [x] 表单验证提示正确
- [x] 编辑时地址回显正确
- [x] 保存后地址显示正确

### 兼容性测试
- [x] 现有公司数据正常显示
- [x] 新旧地址字段共存
- [x] API 接口向后兼容

## 🎉 效果展示

### 新增公司页面
- 省市县三级联动选择
- 中英文详细地址输入
- 实时验证和错误提示
- 响应式界面设计

### 公司列表页面
- 完整地址信息显示
- 地址过长时智能截断
- 鼠标悬停显示完整地址

---

**更新时间**: 2024年1月
**版本**: v1.1.0
**开发者**: AI Assistant 