# 路由冲突修复总结

## 问题描述
后端启动时出现路由冲突错误，原因是在多个文件中重复定义了相同的路由组 `/api/policies`。

## 问题原因
1. 在 `policy_routes.go` 中已经定义了 `/api/policies` 路由组
2. 在 `change_record_routes.go` 中又重复创建了同一个路由组
3. 导致路由冲突，服务器无法启动

## 解决方案
将变更记录相关的路由整合到现有的保单路由文件中，避免重复创建路由组。

### 修改的文件
1. **internal/routes/policy_routes.go**
   - 修改函数签名，添加 `changeRecordController` 参数
   - 在现有的 `/api/policies` 路由组中添加变更记录路由
   - 新增路由：`GET /:policy_id/change-records`

2. **internal/routes/change_record_routes.go**
   - 移除重复的保单变更记录路由
   - 只保留通用的变更记录查询路由 `/api/change-records`

3. **internal/routes/routes.go**
   - 修改 `SetupPolicyRoutes` 的调用，传入变更记录控制器

## 最终路由结构
```
/api/policies/
├── GET      ""                    # 获取保单列表
├── POST     ""                    # 创建保单
├── GET      "/statistics"         # 保单统计
├── GET      "/validation-rules"   # 验证规则
├── POST     "/export"             # 导出保单
├── GET      "/template"           # 下载模板
├── POST     "/import/preview"     # 预览导入
├── POST     "/import"             # 导入保单
├── GET      "/:id"                # 获取保单详情
├── PUT      "/:id"                # 更新保单
├── DELETE   "/:id"                # 删除保单
├── GET      "/:policy_id/change-records"  # 获取保单变更记录 ⭐新增
└── POST     "/batch-update"       # 批量更新

/api/change-records/
└── GET      ""                    # 获取变更记录列表
```

## 测试结果
✅ 项目构建成功，无编译错误
✅ 路由冲突问题已解决
✅ 变更记录功能路由正确配置

## API访问路径
- 获取保单变更记录：`GET /api/policies/{policy_id}/change-records`
- 获取所有变更记录：`GET /api/change-records`

前端可以正常调用这些API来获取变更记录数据。 